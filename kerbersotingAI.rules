# Kerberoasting - SPN enumeration via LDAP
alert tcp any any -> any 389 (msg:"Kerberoasting - SPN enumeration"; content:"servicePrincipalName=*"; sid:1002001; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - Bulk SPN queries
alert tcp any any -> any 389 (msg:"Kerberoasting - Bulk SPN enumeration"; content:"servicePrincipalName"; threshold:type both, track by_src, count 5, seconds 30; sid:1002002; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - TGS-REQ for service accounts
alert udp any any -> any 88 (msg:"Kerberoasting - TGS-REQ for service account"; content:"|a0 03 02 01 05 a1|"; content:"|a2|"; distance:0; within:100; sid:1002003; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase2;)

# Kerberoasting - Multiple TGS requests
alert udp any any -> any 88 (msg:"Kerberoasting - Multiple TGS requests"; content:"|6a 82|"; threshold:type both, track by_src, count 10, seconds 60; sid:1002004; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase2;)

# Kerberoasting - Service account enumeration
alert tcp any any -> any 389 (msg:"Kerberoasting - Service account enumeration"; content:"(&(servicePrincipalName=*)(UserAccountControl:1.2.840.113556.1.4.803:=512))"; sid:1002005; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - SQL service targeting
alert tcp any any -> any 389 (msg:"Kerberoasting - SQL service enumeration"; content:"servicePrincipalName"; content:"MSSQLSvc"; distance:0; within:50; sid:1002006; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - HTTP service targeting
alert tcp any any -> any 389 (msg:"Kerberoasting - HTTP service enumeration"; content:"servicePrincipalName"; content:"HTTP/"; distance:0; within:50; sid:1002007; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - CIFS service targeting
alert tcp any any -> any 389 (msg:"Kerberoasting - CIFS service enumeration"; content:"servicePrincipalName"; content:"cifs/"; distance:0; within:50; sid:1002008; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - Large TGS response (encrypted ticket)
alert udp any 88 -> any any (msg:"Kerberoasting - Large TGS response"; dsize:>2000; content:"|6b 82|"; sid:1002009; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase2;)

# Kerberoasting - RC4 encryption preference
alert udp any any -> any 88 (msg:"Kerberoasting - RC4 encryption request"; content:"|30 39 a0 03 02 01 17|"; sid:1002010; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase2;)

# Kerberoasting - Exchange service enumeration
alert tcp any any -> any 389 (msg:"Kerberoasting - Exchange service enumeration"; content:"servicePrincipalName"; content:"exchangeMDB"; distance:0; within:50; sid:1002011; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - Service account without delegation
alert tcp any any -> any 389 (msg:"Kerberoasting - Non-delegatable service account enum"; content:"(&(servicePrincipalName=*)(!(UserAccountControl:1.2.840.113556.1.4.803:=1048576)))"; sid:1002012; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - High value service accounts
alert tcp any any -> any 389 (msg:"Kerberoasting - High value service account enum"; content:"servicePrincipalName"; content:"adminSDHolder"; distance:0; within:100; sid:1002013; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - Password never expires check
alert tcp any any -> any 389 (msg:"Kerberoasting - Password never expires enum"; content:"(&(servicePrincipalName=*)(UserAccountControl:1.2.840.113556.1.4.803:=65536))"; sid:1002014; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - Service account last logon check
alert tcp any any -> any 389 (msg:"Kerberoasting - Service account activity check"; content:"servicePrincipalName"; content:"lastLogon"; distance:0; within:100; sid:1002015; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - PowerShell GetUserSPNs pattern
alert tcp any any -> any 389 (msg:"Kerberoasting - PowerShell GetUserSPNs pattern"; content:"(&(samAccountType=805306368)(servicePrincipalName=*))"; sid:1002016; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - Kerberos pre-authentication disabled check
alert tcp any any -> any 389 (msg:"Kerberoasting - Pre-auth disabled enum"; content:"(&(servicePrincipalName=*)(UserAccountControl:1.2.840.113556.1.4.803:=4194304))"; sid:1002017; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - Service account password age
alert tcp any any -> any 389 (msg:"Kerberoasting - Service account password age"; content:"servicePrincipalName"; content:"pwdLastSet"; distance:0; within:100; sid:1002018; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - Rubeus tool pattern
alert udp any any -> any 88 (msg:"Kerberoasting - Rubeus TGS pattern"; content:"|30 82|"; content:"|a0 03 02 01 05|"; content:"|a2 82|"; distance:0; within:200; sid:1002019; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase2;)

# Kerberoasting - Service ticket export attempt
alert tcp any any -> any any (msg:"Kerberoasting - Service ticket export"; content:"base64"; content:"doIE"; distance:0; within:50; sid:1002020; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase3;)

# Kerberoasting - Multiple encryption types request
alert udp any any -> any 88 (msg:"Kerberoasting - Multiple encryption types"; content:"|a0 03 02 01 17|"; content:"|a0 03 02 01 12|"; sid:1002021; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase2;)

# Kerberoasting - Service class enumeration
alert tcp any any -> any 389 (msg:"Kerberoasting - Service class enumeration"; content:"servicePrincipalName"; pcre:"/[A-Z]+\//"; sid:1002022; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - Domain trust enumeration for SPNs
alert tcp any any -> any 389 (msg:"Kerberoasting - Cross-domain SPN enum"; content:"servicePrincipalName"; content:"@"; distance:0; within:100; sid:1002023; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - Service account group membership
alert tcp any any -> any 389 (msg:"Kerberoasting - Service account group enum"; content:"servicePrincipalName"; content:"memberOf"; distance:0; within:100; sid:1002024; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase1;)

# Kerberoasting - Ticket lifetime check
alert udp any any -> any 88 (msg:"Kerberoasting - Extended ticket lifetime"; content:"|30 1a a0 11 18 0f|"; sid:1002025; rev:1; classtype:trojan-activity; metadata:attack_target Client_Endpoint, created_at 2024_01_01, deployment Perimeter, tag Kerberoasting_Phase2;)
