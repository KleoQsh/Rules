alert tcp 192.168.1.0/24 any -> any 445 (msg:"PTH-BASE: NTLM hash authentication"; content:"|4e 54 4c 4d 53 53 50|"; content:"|01 00 00 00|"; distance:0; within:20; threshold:type both,track by_src,count 3,seconds 60; flowbits:set,pth.ntlm.auth; flowbits:noalert; classtype:attempted-admin; sid:8001001; rev:1;)
alert tcp 192.168.1.0/24 any -> any 445 (msg:"PTH-BASE: SMB session without password"; content:"Session Setup AndX"; content:"|00 00|"; distance:0; within:50; threshold:type both,track by_src,count 2,seconds 45; flowbits:set,pth.smb.nopwd; flowbits:noalert; classtype:attempted-admin; sid:8001002; rev:1;)
alert tcp 192.168.1.0/24 any -> any 445 (msg:"PTH-BASE: LM hash usage detection"; content:"|aa aa aa aa aa aa aa aa|"; threshold:type both,track by_src,count 2,seconds 40; flowbits:set,pth.lm.hash; flowbits:noalert; classtype:attempted-admin; sid:8001003; rev:1;)
alert tcp 192.168.1.0/24 any -> any 445 (msg:"PTH-BASE: Null session establishment"; content:"IPC$"; content:"|00 00|"; distance:0; within:30; threshold:type both,track by_src,count 3,seconds 50; flowbits:set,pth.null.session; flowbits:noalert; classtype:attempted-admin; sid:8001004; rev:1;)
alert tcp 192.168.1.0/24 any -> any 139 (msg:"PTH-BASE: NetBIOS hash authentication"; content:"|4e 54 4c 4d|"; threshold:type both,track by_src,count 2,seconds 45; flowbits:set,pth.netbios.auth; flowbits:noalert; classtype:attempted-admin; sid:8001005; rev:1;)
alert tcp 192.168.1.0/24 any -> any 445 (msg:"PTH-ADV: Multiple hash authentication attempts"; content:"|4e 54 4c 4d 53 53 50|"; threshold:type both,track by_src,count 5,seconds 120; flowbits:set,pth.multiple.attempts; flowbits:noalert; classtype:attempted-admin; sid:8001006; rev:1;)
alert tcp 192.168.1.0/24 any -> any 445 (msg:"PTH-ADV: Administrative share access"; content:"ADMIN$"; threshold:type both,track by_src,count 2,seconds 60; flowbits:set,pth.admin.share; flowbits:noalert; classtype:attempted-admin; sid:8001007; rev:1;)
alert tcp 192.168.1.0/24 any -> any 445 (msg:"PTH-ADV: Cross-system hash reuse"; threshold:type both,track by_src,count 8,seconds 300; flowbits:set,pth.cross.system; flowbits:noalert; classtype:attempted-admin; sid:8001008; rev:1;)
alert tcp 192.168.1.0/24 any -> any 445 (msg:"PTH-ADV: Lateral movement pattern"; content:"psexesvc"; threshold:type both,track by_src,count 2,seconds 45; flowbits:set,pth.lateral.movement; flowbits:noalert; classtype:attempted-admin; sid:8001009; rev:1;)
alert tcp 192.168.1.0/24 any -> any 445 (msg:"PTH-ADV: Service creation for PTH"; content:"CreateService"; threshold:type both,track by_src,count 2,seconds 60; flowbits:set,pth.service.creation; flowbits:noalert; classtype:attempted-admin; sid:8001010; rev:1;)
alert tcp 192.168.1.0/24 any -> any 135 (msg:"PTH-ADV: RPC over SMB with hash"; content:"|05 00|"; content:"|4e 54 4c 4d|"; distance:0; within:100; threshold:type both,track by_src,count 2,seconds 45; flowbits:set,pth.rpc.smb; flowbits:noalert; classtype:attempted-admin; sid:8001011; rev:1;)
alert tcp 192.168.1.0/24 any -> any any (msg:"COMBO-PTH-BASIC: NTLM and null session"; flowbits:isset,pth.ntlm.auth; flowbits:isset,pth.null.session; threshold:type limit,track by_src,count 1,seconds 300; classtype:attempted-admin; priority:2; sid:8002001; rev:1;)
alert tcp 192.168.1.0/24 any -> any any (msg:"COMBO-PTH-BASIC: Hash auth and admin access"; flowbits:isset,pth.smb.nopwd; flowbits:isset,pth.admin.share; threshold:type limit,track by_src,count 1,seconds 300; classtype:attempted-admin; priority:2; sid:8002002; rev:1;)
alert tcp 192.168.1.0/24 any -> any any (msg:"COMBO-PTH-ADVANCED: Pass-the-Hash lateral movement"; flowbits:isset,pth.ntlm.auth; flowbits:isset,pth.lateral.movement; flowbits:isset,pth.cross.system; threshold:type limit,track by_src,count 1,seconds 300; classtype:attempted-admin; priority:1; sid:8002003; rev:1;)
alert tcp 192.168.1.0/24 any -> any any (msg:"COMBO-PTH-EXPERT: Advanced PTH attack campaign"; flowbits:isset,pth.multiple.attempts; flowbits:isset,pth.service.creation; flowbits:isset,pth.rpc.smb; flowbits:isset,pth.admin.share; threshold:type limit,track by_src,count 1,seconds 300; classtype:attempted-admin; priority:1; sid:8002004; rev:1;)
